<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë„¤ì´ë²„ ë²¡í„°ë§µ í…ŒìŠ¤íŠ¸ - ë°ìŠ¤í¬íƒ‘ ì „ìš© ë ˆì´ì•„ì›ƒ (ê²€ìƒ‰ íŒ¨ë„)</title>
    <style>
        /* ------------------------------------------------ */
        /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë° ìŠ¤íƒ€ì¼ */
        /* ------------------------------------------------ */
        body { 
            margin: 0;
            padding: 0; 
            height: 100vh; 
            font-family: 'Malgun Gothic', sans-serif;
            overflow: hidden; /* ì „ì²´ í˜ì´ì§€ ìŠ¤í¬ë¡¤ ë°©ì§€ */
            display: flex; /* Flexboxë¡œ ì¢Œìš° ë¶„í•  */
        }

        /* ------------------------------------------------ */
        /* ì¢Œì¸¡ ê²€ìƒ‰ íŒ¨ë„ (1/5) */
        /* ------------------------------------------------ */
        #searchPanel {
            width: 20%; /* 5ë¶„ì˜ 1 */
            height: 100%;
            background: #ffffff;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
        }

        /* ------------------------------------------------ */
        /* ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ (íŒ¨ë„ ìƒë‹¨) */
        /* ------------------------------------------------ */
        #searchBox {
            width: 100%;
            height: 48px;
            padding: 0;
            background: #f1f1f1;
            border-radius: 4px;
            box-shadow: none; /* íŒ¨ë„ ë‚´ë¶€ì—ì„œëŠ” ê·¸ë¦¼ì ì œê±° */
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            position: relative;
            transform: none;
            left: auto;
            top: auto;
        }

        #searchInput {
            flex-grow: 1;
            height: 100%;
            border: none;
            padding: 0 15px;
            font-size: 16px;
            background: transparent;
            outline: none;
        }

        #searchIcon {
            padding: 0 10px;
            cursor: pointer;
            font-size: 20px;
            color: #555;
        }

        /* ------------------------------------------------ */
        /* ê±´ë¬¼ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        /* ------------------------------------------------ */
        #buildingList {
            flex-grow: 1;
            overflow-y: auto; /* ë¦¬ìŠ¤íŠ¸ê°€ ê¸¸ì–´ì§ˆ ê²½ìš° ìŠ¤í¬ë¡¤ í—ˆìš© */
            padding: 0;
            list-style: none;
            margin: 0;
        }

        .building-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background 0.1s;
        }

        .building-item:hover {
            background: #f9f9f9;
        }

        .building-item.selected {
            background: #e6f7ff;
        }

        .building-list-image {
            width: 50px;
            height: 50px;
            border-radius: 4px;
            object-fit: cover;
            margin-right: 10px;
        }

        .building-info-text {
            display: flex;
            flex-direction: column;
        }

        .building-name {
            font-weight: bold;
            font-size: 15px;
            color: #333;
        }

        .building-address {
            font-size: 12px;
            color: #777;
        }


        /* ------------------------------------------------ */
        /* ìš°ì¸¡ ì§€ë„ ì˜ì—­ (4/5) */
        /* ------------------------------------------------ */
        #map { 
            width: 80%; /* 5ë¶„ì˜ 4 */
            height: 100%; 
        }

        /* ------------------------------------------------ */
        /* ì§€ë„ ìœ„ UI ìš”ì†Œ ìœ„ì¹˜ ì¡°ì • */
        /* ------------------------------------------------ */
        
        /* 1. coordDisplay (ì§€ë„ ìƒë‹¨ ì¤‘ì•™) */
        #coordDisplay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-size: 14px;
            color: #333;
            z-index: 1000; 
            white-space: nowrap;
        }

        /* 2. ì¸µ ë²„íŠ¼ Wrapper (ì§€ë„ ìš°ì¸¡ ìƒë‹¨) */
        #floorBtnWrapper {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 1000;
        }

        .floor-btn {
            width: 40px;
            height: 40px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .floor-btn.active {
            background-color: #4285f4;
            color: white;
            border-color: #4285f4;
        }

        /* 3. ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´ ë²„íŠ¼ (ì§€ë„ ìš°ì¸¡ í•˜ë‹¨) */
        #accessBtn {
            position: absolute;
            right: 20px;
            bottom: 20px;
            width: 48px;
            height: 48px;
            background-color: #ffffff;
            border: none;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            font-size: 24px;
            color: #4285f4;
            z-index: 1000;
        }

        #accessBtn:hover {
            background-color: #f0f0f0;
        }

        #accessBtn.active {
            background-color: #4285f4;
            color: white;
        }

        /* 4. ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´ íŒì—… (ì§€ë„ ìœ„) */
        #accessPopup {
            position: absolute;
            right: 80px; /* ë²„íŠ¼ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë„ìš°ê¸° ìœ„í•´ ì¡°ì • */
            bottom: 20px;
            width: 300px;
            max-height: 400px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            padding: 15px;
        }

        /* íŒì—… ë‚´ë¶€ ìŠ¤íƒ€ì¼ */
        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .popup-header h3 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }

        #popupClose {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #aaa;
        }
        
        #popupImage {
            width: 100%;
            height: auto;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .info-section {
            margin-bottom: 10px;
        }

        .info-section h4 {
            font-size: 14px;
            color: #555;
            margin: 0 0 5px 0;
            border-bottom: 1px dashed #eee;
            padding-bottom: 3px;
        }

        .info-section p {
            font-size: 13px;
            color: #333;
            margin: 0 0 5px 0;
            line-height: 1.4;
        }

        .access-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .access-item {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            padding: 5px 0;
            border-bottom: 1px dotted #f0f0f0;
        }

        .access-status {
            font-weight: bold;
        }

        .status-ok {
            color: #4CAF50; /* Green */
        }

        .status-no {
            color: #F44336; /* Red */
        }

        /* ------------------------------------------------ */
        /* ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ ìˆ¨ê¹€ */
        /* ------------------------------------------------ */
        #searchResultList {
            position: absolute;
            top: 48px;
            left: 0;
            width: 100%;
            background: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            max-height: 300px;
            overflow-y: auto;
            display: none; /* ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ */
            z-index: 10;
            list-style: none;
            padding: 0;
            margin: 0;
        }
    </style>
</head>
<body>
    
    <div id="searchPanel">
        <div id="searchBox">
            <input type="text" id="searchInput" placeholder="ê±´ë¬¼ ì´ë¦„ ê²€ìƒ‰" />
            <div id="searchIcon">ğŸ”</div>
            <ul id="searchResultList"></ul>
        </div>

        <ul id="buildingList">
            </ul>
    </div>
    
    <div id="map">
        <div id="floorBtnWrapper">
            </div>

        <button id="accessBtn">â„¹</button>

        <div id="accessPopup">
            <div class="popup-header">
                <h3 id="popupBuildingName">ê±´ë¬¼ ì´ë¦„</h3>
                <button id="popupClose">Ã—</button>
            </div>
            <img id="popupImage" src="" alt="ê±´ë¬¼ ì´ë¯¸ì§€" />
            <div class="info-section">
                <h4>ê±´ë¬¼ ì •ë³´</h4>
                <p>ì£¼ì†Œ: <span id="popupAddress"></span></p>
                <p>ìš´ì˜ ì‹œê°„: <span id="popupHours"></span></p>
            </div>
            <div class="info-section">
                <h4>ë¬´ì¥ì•  ì‹œì„¤</h4>
                <ul class="access-list" id="accessInfoList">
                    </ul>
            </div>
        </div>

        <div id="coordDisplay">ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ê±´ë¬¼ ì™¸ê³½ì„ ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</div>
    </div>


    <script
        type="text/javascript"
        src="https://oapi.map.naver.com/openapi/v3/maps.js?NCP_KEY_ID=q1d23mmkof&submodules=panorama"
    ></script>
    <script>
        var map;
        var currentBuildingId = null;
        var currentPolygon = null;
        var currentOverlay = null;

        function initMap() {
            // ì´ˆê¸° ì§€ë„ ì„¤ì •
            var mapOptions = {
                center: new naver.maps.LatLng(37.56701, 126.97722), // ì„œìš¸ ì‹œì²­ ê·¼ì²˜
                zoom: 18, // í™•ëŒ€ ë ˆë²¨
                mapTypeId: naver.maps.MapTypeId.NORMAL,
                mapTypes: new naver.maps.MapTypeRegistry({
                    'indoor': {
                        minZoom: 18,
                        maxZoom: 20,
                        name: 'ì‹¤ë‚´ì§€ë„',
                        getTileUrl: function(x, y, z) {
                            return 'https://map.naver.com/indoor/tiles/indoor_v1/indoor_v1/' + z + '/' + x + '/' + y + '.png';
                        }
                    }
                }),
                tileSet: 'indoor',
                vector: true,
            };

            map = new naver.maps.Map('map', mapOptions);

            // =========================================================
            // ë¹Œë”©ë³„ ë°ì´í„° ì •ì˜ (ì¸µë³„ ê²½ê³„ ë¶„ë¦¬ ì ìš©)
            // =========================================================
            var ky_default_bounds = new naver.maps.LatLngBounds(
                new naver.maps.LatLng(37.570512, 126.977632), // ê¸°ì¡´ SW
                new naver.maps.LatLng(37.571415, 126.978244)  // ê¸°ì¡´ NE
            );
            var dt_default_bounds = new naver.maps.LatLngBounds(
                new naver.maps.LatLng(37.570459, 126.978649), 
                new naver.maps.LatLng(37.571626, 126.979210)  
            );
            var buildings = {
                'ky': { // ê±´ë¬¼ 1 (ì˜ˆì‹œ: êµë³´ë¹Œë”©)
                    polygonCoords: [
                        new naver.maps.LatLng(37.571350, 126.977670),
                        new naver.maps.LatLng(37.571360, 126.978059),
                        new naver.maps.LatLng(37.571275, 126.978063),
                        new naver.maps.LatLng(37.571275, 126.978173),
                        new naver.maps.LatLng(37.570870, 126.978184),
                        new naver.maps.LatLng(37.570872, 126.978082),
                        new naver.maps.LatLng(37.570543, 126.978094),
                        new naver.maps.LatLng(37.570539, 126.977702),
                    ],
                    floors: ['b1', '1f', '2f'],
                    images: {
                        'b1': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/kb_b111.png',
                        '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky11.png', 
                        '2f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky_1.jpg',
                    },
                    // ì¸µë³„ ê²½ê³„ ì •ë³´ë¥¼ ê°ì²´ë¡œ ë¶„ë¦¬í•˜ì—¬ ì €ì¥
                    floorBounds: { 
                        'b1': new naver.maps.LatLngBounds( // B1: ì‚¬ìš©ìê°€ ìš”ì²­í•œ ìƒˆë¡œìš´ ê²½ê³„
                            new naver.maps.LatLng(37.571590, 126.978531), // SW
                            new naver.maps.LatLng(37.570465, 126.977552)  // NE
                        ),
                        '1f': ky_default_bounds, // 1F: ê¸°ì¡´ ê²½ê³„ ì‚¬ìš©
                        '2f': ky_default_bounds, // 2F: ê¸°ì¡´ ê²½ê³„ ì‚¬ìš©
                    },
                    currentFloor: '1f', 
                    polygon: null,
                    accessInfo: {
                        'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ': true,
                        'ì¥ì• ì¸ í™”ì¥ì‹¤': true,
                        'ì§•ì• ì¸ ì£¼ì°¨ì¥': true,
                        'ì—˜ë¦¬ë² ì´í„°': true,
                        'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨': false 
                    },
                    // ê±´ë¬¼ ìƒì„¸ ì •ë³´
                    buildingInfo: {
                        name: 'êµë³´ë¹Œë”©',
                        image_url: 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/kyobo_gwanghwamun.jpg', 
                        address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ìƒˆë¬¸ì•ˆë¡œ 45',
                        operating_hours: '09:00 - 18:00 (ì›”ìš”ì¼ íœ´ë¬´)'
                    }
                },
                'dt': { 
                    // ê±´ë¬¼ 2 (ì˜ˆì‹œ: ê´‘í™”ë¬¸ Díƒ€ì›Œ)
                    polygonCoords: [
                        new naver.maps.LatLng(37.571470, 126.978762),
                        new naver.maps.LatLng(37.571476, 126.979161),
                        new naver.maps.LatLng(37.570627, 126.979181),
                        new naver.maps.LatLng(37.570557, 126.979117),
                        new naver.maps.LatLng(37.570553, 126.978777),
                    ],
                    floors: ['b4', '1f'], 
                    images: {
                        'b4': 'https://raw.githubusercontent.com/candream99/disabledmap/main/dt/dt_b4.png',
                        '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/dt/dt1.png',
                    },
                    // ì¸µë³„ ê²½ê³„ ì •ë³´ë¥¼ ê°ì²´ë¡œ ë¶„ë¦¬í•˜ì—¬ ì €ì¥
                    floorBounds: { 
                        'b4': dt_default_bounds, // B4: ê¸°ì¡´ ê²½ê³„ ì‚¬ìš©
                        '1f': dt_default_bounds, // 1F: ê¸°ì¡´ ê²½ê³„ ì‚¬ìš©
                    },
                    currentFloor: '1f',
                    polygon: null,
                    accessInfo: {
                        'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ': false,
                        'ì¥ì• ì¸ í™”ì¥ì‹¤': true, 
                        'ì¥ì• ì¸ ì£¼ì°¨ì¥': false,
                        'ì—˜ë¦¬ë² ì´í„°': true,
                        'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨': true 
                    },
                    // ê±´ë¬¼ ìƒì„¸ ì •ë³´
                    buildingInfo: {
                        name: 'ê´‘í™”ë¬¸ Díƒ€ì›Œ',
                        image_url: 'https://raw.githubusercontent.com/candream99/disabledmap/main/dt/d_tower.jpg', 
                        address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ì†¡ì›”ê¸¸ 2',
                        operating_hours: '10:00 - 19:00 (ë§¤ì¼ ìš´ì˜)'
                    }
                },
                't8': { // ê±´ë¬¼ 3: íƒ€ì›Œ8
                    polygonCoords: [
                        new naver.maps.LatLng(37.570859, 126.980318),
                        new naver.maps.LatLng(37.570854, 126.980784),
                        new naver.maps.LatLng(37.570515, 126.980785),
                        new naver.maps.LatLng(37.570514, 126.980841),
                        new naver.maps.LatLng(37.570417, 126.980840),
                        new naver.maps.LatLng(37.570418, 126.980288),
                        new naver.maps.LatLng(37.570518, 126.980287),
                        new naver.maps.LatLng(37.570518, 126.980315),
                    ],
                    floors: ['b2', 'b1', '1f'], // ìš”ì²­í•˜ì‹  ì¸µë³„ ë²„íŠ¼ ìˆœì„œ
                    images: {
                        'b2': 'https://raw.githubusercontent.com/candream99/disabledmap/main/T8/T8_b2.png',
                        'b1': 'https://raw.githubusercontent.com/candream99/disabledmap/main/T8/T8_b1.png',
                        '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/T8/T8_1.png',
                    },
                    // ì¸µë³„ ê²½ê³„ ì •ë³´ë¥¼ ê°ì²´ë¡œ ë¶„ë¦¬í•˜ì—¬ ì €ì¥
                    floorBounds: { 
                        // ìš”ì²­í•˜ì‹  ë™ì¼í•œ ë¶ë™(NE) ë° ë‚¨ì„œ(SW) ì¢Œí‘œë¥¼ ëª¨ë“  ì¸µì— ì ìš©
                        'b2': new naver.maps.LatLngBounds( 
                            new naver.maps.LatLng(37.570405, 126.980209), // SW
                            new naver.maps.LatLng(37.570902, 126.981077)  // NE
                        ),
                        'b1': new naver.maps.LatLngBounds( 
                            new naver.maps.LatLng(37.570405, 126.980209), // SW
                            new naver.maps.LatLng(37.570902, 126.981077)  // NE
                        ),
                        '1f': new naver.maps.LatLngBounds( 
                            new naver.maps.LatLng(37.570405, 126.980209), // SW
                            new naver.maps.LatLng(37.570902, 126.981077)  // NE
                        ),
                    },
                    currentFloor: '1f',
                    polygon: null,
                    // ì„ì˜ì˜ ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´
                    accessInfo: {
                        'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ': true,
                        'ì¥ì• ì¸ í™”ì¥ì‹¤': false, 
                        'ì¥ì• ì¸ ì£¼ì°¨ì¥': true,
                        'ì—˜ë¦¬ë² ì´í„°': true,
                        'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨': false 
                    },
                    // ê±´ë¬¼ ìƒì„¸ ì •ë³´
                    buildingInfo: {
                        name: 'íƒ€ì›Œ8',
                        image_url: 'https://raw.githubusercontent.com/candream99/disabledmap/main/T8/t88.jpg', 
                        address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ì²­ì§„ë™ 167 (ì„ì˜)',
                        operating_hours: '08:00 - 22:00 (ì£¼ë§ í¬í•¨)'
                    }
                },
                'officia': { // ê±´ë¬¼ 4: ê´‘í™”ë¬¸ ì˜¤í”¼ì‹œì•„
                    polygonCoords: [
                        new naver.maps.LatLng(37.569884, 126.974610), // ìœ„ë„, ê²½ë„
                        new naver.maps.LatLng(37.569882, 126.975265),
                        new naver.maps.LatLng(37.569580, 126.975261),
                        new naver.maps.LatLng(37.569581, 126.974603),
                    ],
                    floors: ['b2', 'b1', '1f'], 
                    images: {
                        // ëª¨ë“  ì¸µì— ë™ì¼í•œ ì´ë¯¸ì§€ URL ì ìš©
                        'b2': 'https://raw.githubusercontent.com/candream99/disabledmap/main/officia/officia_b1.png',
                        'b1': 'https://raw.githubusercontent.com/candream99/disabledmap/main/officia/officia_b1.png',
                        '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/officia/officia_1f.png',
                    },
                    // ì¸µë³„ ê²½ê³„ ì •ë³´ (ìš”ì²­í•˜ì‹  ëŒ€ë¡œ ì¸µë§ˆë‹¤ ë¶„ë¦¬í•˜ì—¬ ë™ì¼í•œ ê²½ê³„ ì ìš©)
                    floorBounds: { 
                        'b2': new naver.maps.LatLngBounds(
                            new naver.maps.LatLng(37.569519, 126.974473), // SW (ë‚¨ì„œ)
                            new naver.maps.LatLng(37.569976, 126.975331)  // NE (ë¶ë™)
                        ),
                        'b1': new naver.maps.LatLngBounds(
                            new naver.maps.LatLng(37.569519, 126.974473), // SW
                            new naver.maps.LatLng(37.569976, 126.975331)  // NE
                        ),
                        '1f': new naver.maps.LatLngBounds(
                            new naver.maps.LatLng(37.569519, 126.974473), // SW
                            new naver.maps.LatLng(37.569976, 126.975331)  // NE
                        ),
                    },
                    currentFloor: '1f',
                    polygon: null,
                    // ì„ì˜ì˜ ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´
                    accessInfo: {
                        'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ': true,
                        'ì¥ì• ì¸ í™”ì¥ì‹¤': true, 
                        'ì¥ì• ì¸ ì£¼ì°¨ì¥': true,
                        'ì—˜ë¦¬ë² ì´í„°': true,
                        'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨': false 
                    },
                    // ê±´ë¬¼ ìƒì„¸ ì •ë³´ (ê²€ìƒ‰ ë¦¬ìŠ¤íŠ¸ ë° íŒì—…ìš©)
                    buildingInfo: { 
                        name: 'ê´‘í™”ë¬¸ ì˜¤í”¼ì‹œì•„', 
                        image_url: 'https://raw.githubusercontent.com/candream99/disabledmap/main/officia/officia_.jpg', // Ië²„íŠ¼ íŒì—… ë° ê²€ìƒ‰ ë¦¬ìŠ¤íŠ¸ ì´ë¯¸ì§€
                        address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ìƒˆë¬¸ì•ˆë¡œ5ê¸¸ 37 (ì„ì˜ ì£¼ì†Œ)', 
                        operating_hours: '10:00 - 20:00 (ì£¼ë§ íœ´ë¬´, ì„ì˜)'
                    }
                },
                'st': { // ê±´ë¬¼ 5: Síƒ€ì›Œ
                    polygonCoords: [
                        new naver.maps.LatLng(37.569910, 126.973684), // ìœ„ë„, ê²½ë„
                        new naver.maps.LatLng(37.569904, 126.974217),
                        new naver.maps.LatLng(37.569688, 126.974214),
                        new naver.maps.LatLng(37.569688, 126.973680),
                    ],
                    floors: ['b2', 'b1', '1f'], 
                    images: {
                        // ëª¨ë“  ì¸µì— ë™ì¼í•œ ì´ë¯¸ì§€ URL ì ìš©
                        'b2': 'https://raw.githubusercontent.com/candream99/disabledmap/main/st/st_b1.png',
                        'b1': 'https://raw.githubusercontent.com/candream99/disabledmap/main/st/st_b1.png',
                        '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/st/st_1.png',
                    },
                    // ì¸µë³„ ê²½ê³„ ì •ë³´ (ìš”ì²­í•˜ì‹  ëŒ€ë¡œ ì¸µë§ˆë‹¤ ë¶„ë¦¬í•˜ì—¬ ë™ì¼í•œ ê²½ê³„ ì ìš©)
                    floorBounds: { 
                        'b2': new naver.maps.LatLngBounds( 
                            new naver.maps.LatLng(37.569473, 126.973510), // SW
                            new naver.maps.LatLng(37.570081, 126.974351)  // NE
                        ),
                        'b1': new naver.maps.LatLngBounds( 
                            new naver.maps.LatLng(37.569473, 126.973510), // SW
                            new naver.maps.LatLng(37.570081, 126.974351)  // NE
                        ),
                        '1f': new naver.maps.LatLngBounds( 
                            new naver.maps.LatLng(37.569473, 126.973510), // SW
                            new naver.maps.LatLng(37.570081, 126.974351)  // NE
                        ),
                    },
                    currentFloor: '1f',
                    polygon: null,
                    // ì„ì˜ì˜ ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´
                    accessInfo: {
                        'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ': false,
                        'ì¥ì• ì¸ í™”ì¥ì‹¤': true, 
                        'ì¥ì• ì¸ ì£¼ì°¨ì¥': true,
                        'ì—˜ë¦¬ë² ì´í„°': true,
                        'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨': true 
                    },
                    // ê±´ë¬¼ ìƒì„¸ ì •ë³´ (ê²€ìƒ‰ ë¦¬ìŠ¤íŠ¸ ë° íŒì—…ìš©)
                    buildingInfo: { 
                        name: 'Síƒ€ì›Œ', 
                        image_url: 'https://raw.githubusercontent.com/candream99/disabledmap/main/st/s_tower.jpg', // Ië²„íŠ¼ íŒì—… ë° ê²€ìƒ‰ ë¦¬ìŠ¤íŠ¸ ì´ë¯¸ì§€
                        address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ì„¸ì¢…ëŒ€ë¡œ 172 (ì„ì˜ ì£¼ì†Œ)', 
                        operating_hours: '11:00 - 20:00 (ì£¼ë§ í¬í•¨, ì„ì˜)'
                    }
                },
                'yp': { // ê±´ë¬¼ 6: ì˜í’ë¹Œë”© (ì‚¬ìš©ì ìš”ì²­ ì¶”ê°€)
                    polygonCoords: [
                        new naver.maps.LatLng(37.569881, 126.981938),
                        new naver.maps.LatLng(37.569879, 126.982329),
                        new naver.maps.LatLng(37.569829, 126.982332),
                        new naver.maps.LatLng(37.569828, 126.982395),
                        new naver.maps.LatLng(37.569780, 126.982395),
                        new naver.maps.LatLng(37.569777, 126.982463),
                        new naver.maps.LatLng(37.569463, 126.982461),
                        new naver.maps.LatLng(37.569462, 126.982068),
                        new naver.maps.LatLng(37.569565, 126.981938),
                    ],
                    floors: ['b1', '1f'], // ìš”ì²­í•˜ì‹  ì¸µ: B1, 1F
                    images: {
                        'b1': 'https://raw.githubusercontent.com/candream99/disabledmap/main/yp/yp1.png', // ëª¨ë“  ì¸µ ë™ì¼ ì´ë¯¸ì§€
                        '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/yp/yp1.png',
                    },
                    // ì¸µë³„ ê²½ê³„ ì •ë³´ (ìš”ì²­í•˜ì‹  ë™ì¼í•œ ë¶ë™(NE) ë° ë‚¨ì„œ(SW) ì¢Œí‘œë¥¼ ëª¨ë“  ì¸µì— ì ìš©)
                    floorBounds: { 
                        'b1': new naver.maps.LatLngBounds( 
                            new naver.maps.LatLng(37.569438, 126.981870), // SW: ìœ„ë„: 37.569438, ê²½ë„: 126.981870
                            new naver.maps.LatLng(37.569943, 126.982556)  // NE: ìœ„ë„: 37.569943, ê²½ë„: 126.982556
                        ),
                        '1f': new naver.maps.LatLngBounds( 
                            new naver.maps.LatLng(37.569438, 126.981870), // SW
                            new naver.maps.LatLng(37.569943, 126.982556)  // NE
                        ),
                    },
                    currentFloor: '1f',
                    polygon: null,
                    // ì„ì˜ì˜ ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´
                    accessInfo: {
                        'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ': true,
                        'ì¥ì• ì¸ í™”ì¥ì‹¤': true, 
                        'ì¥ì• ì¸ ì£¼ì°¨ì¥': false, // ì„ì˜
                        'ì—˜ë¦¬ë² ì´í„°': true,
                        'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨': false 
                    },
                    // ê±´ë¬¼ ìƒì„¸ ì •ë³´ (ê²€ìƒ‰ ë¦¬ìŠ¤íŠ¸ ë° íŒì—…ìš©)
                    buildingInfo: { 
                        name: 'ì˜í’ë¹Œë”©', 
                        image_url: 'https://raw.githubusercontent.com/candream99/disabledmap/main/yp/yp_i.jpg', // Ië²„íŠ¼ íŒì—… ë° ê²€ìƒ‰ ë¦¬ìŠ¤íŠ¸ ì´ë¯¸ì§€
                        address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ì²­ê³„ì²œë¡œ 41 (ì„ì˜ ì£¼ì†Œ)', 
                        operating_hours: '09:00 - 21:00 (ì„ì˜)'
                    }
                }
            };


            // =========================================================
            // í•¨ìˆ˜: í´ë¦¬ê³¤ ê·¸ë¦¬ê¸° ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            // =========================================================
            function drawBuildingPolygon(id, building) {
                var polygon = new naver.maps.Polygon({
                    paths: building.polygonCoords,
                    fillColor: '#FF0000',
                    fillOpacity: 0.2,
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    map: map
                });

                building.polygon = polygon; // polygon ê°ì²´ë¥¼ building ë°ì´í„°ì— ì €ì¥

                // í´ë¦¬ê³¤ í´ë¦­ ì´ë²¤íŠ¸
                naver.maps.Event.addListener(polygon, 'click', function(e) {
                    enterBuildingMode(id);
                });
            }

            // =========================================================
            // í•¨ìˆ˜: ì‹¤ë‚´ ëª¨ë“œ ì§„ì… ë° ì˜¤ë²„ë ˆì´ í‘œì‹œ
            // =========================================================
            function enterBuildingMode(id) {
                if (currentBuildingId === id) return; // ì´ë¯¸ ì„ íƒëœ ê±´ë¬¼ì¸ ê²½ìš°
                
                // ê¸°ì¡´ ê±´ë¬¼ í´ë¦¬ê³¤ ì´ˆê¸°í™”
                if (currentBuildingId && buildings[currentBuildingId].polygon) {
                    buildings[currentBuildingId].polygon.setOptions({
                        fillColor: '#FF0000',
                        fillOpacity: 0.2
                    });
                }
                
                // ë¦¬ìŠ¤íŠ¸ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
                updateBuildingListSelection(id);

                currentBuildingId = id;
                var building = buildings[id];

                // ìƒˆ ê±´ë¬¼ í´ë¦¬ê³¤ ê°•ì¡°
                if (building.polygon) {
                    building.polygon.setOptions({
                        fillColor: '#007AFF', // ê°•ì¡° ìƒ‰ìƒ (íŒŒë‘)
                        fillOpacity: 0.4
                    });
                }
                
                // ì§€ë„ ì´ë™ (ê±´ë¬¼ ì¤‘ì‹¬ìœ¼ë¡œ)
                var bounds = naver.maps.LatLngBounds.getBoundsFromCoords(building.polygonCoords);
                map.panTo(bounds.getCenter());

                // ì¸µ ë²„íŠ¼ ìƒì„±
                createFloorButtons(id);

                // ì˜¤ë²„ë ˆì´ ë° ì¸µ ìƒíƒœ ì—…ë°ì´íŠ¸
                updateFloorOverlay(id, building.currentFloor);

                // coordDisplay ì—…ë°ì´íŠ¸
                var coordDisplay = document.getElementById('coordDisplay');
                coordDisplay.textContent = building.buildingInfo.name + ' ì‹¤ë‚´ ëª¨ë“œ ì§„ì…. ì¸µì„ ì„ íƒí•˜ê±°ë‚˜ ì§€ë„ë¥¼ ì´ë™í•˜ì„¸ìš”.';
                
                // ë¬´ì¥ì•  ì •ë³´ ë²„íŠ¼ í™œì„±í™”
                document.getElementById('accessBtn').disabled = false;
            }

            // =========================================================
            // í•¨ìˆ˜: ì¸µ ë²„íŠ¼ ìƒì„± ë° ì´ë²¤íŠ¸ ì—°ê²°
            // =========================================================
            function createFloorButtons(id) {
                var wrapper = document.getElementById('floorBtnWrapper');
                wrapper.innerHTML = ''; // ê¸°ì¡´ ë²„íŠ¼ ëª¨ë‘ ì œê±°
                
                var building = buildings[id];

                // ì¸µì„ ì—­ìˆœìœ¼ë¡œ í‘œì‹œ (ìœ„ì—ì„œ ì•„ë˜ë¡œ 1F -> B1)
                building.floors.slice().reverse().forEach(function(floor) {
                    var btn = document.createElement('button');
                    btn.className = 'floor-btn';
                    btn.textContent = floor.toUpperCase();
                    btn.id = 'btn-' + floor;
                    
                    if (floor === building.currentFloor) {
                        btn.classList.add('active');
                    }

                    btn.onclick = function() {
                        updateFloorOverlay(id, floor);
                        // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
                        document.querySelectorAll('#floorBtnWrapper .floor-btn').forEach(function(b) {
                            b.classList.remove('active');
                        });
                        this.classList.add('active');
                    };

                    wrapper.appendChild(btn);
                });
            }

            // =========================================================
            // í•¨ìˆ˜: ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
            // =========================================================
            function updateFloorOverlay(id, floor) {
                var building = buildings[id];

                // ê¸°ì¡´ ì˜¤ë²„ë ˆì´ ì œê±°
                if (currentOverlay) {
                    currentOverlay.setMap(null);
                }

                building.currentFloor = floor; // í˜„ì¬ ì¸µ ì—…ë°ì´íŠ¸
                
                var imageUrl = building.images[floor];
                var bounds = building.floorBounds[floor];

                // ìƒˆ ì˜¤ë²„ë ˆì´ ìƒì„±
                currentOverlay = new naver.maps.GroundOverlay(
                    imageUrl,
                    bounds,
                    {
                        map: map,
                        opacity: 0.8 // íˆ¬ëª…ë„ ì„¤ì •
                    }
                );
                
                // coordDisplay ì—…ë°ì´íŠ¸
                var coordDisplay = document.getElementById('coordDisplay');
                coordDisplay.textContent = building.buildingInfo.name + ' - ' + floor.toUpperCase() + ' ì¸µì„ ë³´ê³  ìˆìŠµë‹ˆë‹¤.';
            }

            // =========================================================
            // ì§€ë„ ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ì—°ê²°
            // =========================================================

            // ê±´ë¬¼ í´ë¦¬ê³¤ ìƒì„±
            for (var id in buildings) {
                drawBuildingPolygon(id, buildings[id]);
            }
            
            // ì§€ë„ í´ë¦­ ì‹œ ì˜¤ë²„ë ˆì´ ì œê±° (ì‹¤ë‚´ ëª¨ë“œ í•´ì œ)
            naver.maps.Event.addListener(map, 'click', function(e) {
                if (e.originalEvent.target.classList.contains('floor-btn')) {
                    // ì¸µ ë²„íŠ¼ í´ë¦­ì€ ë¬´ì‹œ
                    return; 
                }
                if (currentBuildingId) {
                    // ê¸°ì¡´ ê±´ë¬¼ í´ë¦¬ê³¤ ê°•ì¡° í•´ì œ
                    if (buildings[currentBuildingId].polygon) {
                        buildings[currentBuildingId].polygon.setOptions({
                            fillColor: '#FF0000',
                            fillOpacity: 0.2
                        });
                    }
                    
                    // ì˜¤ë²„ë ˆì´ ì œê±°
                    if (currentOverlay) {
                        currentOverlay.setMap(null);
                        currentOverlay = null;
                    }
                    
                    // ì¸µ ë²„íŠ¼ ì œê±°
                    document.getElementById('floorBtnWrapper').innerHTML = '';
                    
                    // ë¬´ì¥ì•  ì •ë³´ ë²„íŠ¼ ë¹„í™œì„±í™” ë° íŒì—… ë‹«ê¸°
                    document.getElementById('accessBtn').disabled = true;
                    document.getElementById('accessPopup').style.display = 'none';
                    document.getElementById('accessBtn').classList.remove('active');

                    currentBuildingId = null;
                    
                    // ë¦¬ìŠ¤íŠ¸ ì„ íƒ í•´ì œ
                    updateBuildingListSelection(null);

                    var coordDisplay = document.getElementById('coordDisplay');
                    coordDisplay.textContent = 'ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ê±´ë¬¼ ì™¸ê³½ì„ ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.';
                }
            });

            // =========================================================
            // ê²€ìƒ‰ íŒ¨ë„ ë° ë¦¬ìŠ¤íŠ¸ ê¸°ëŠ¥
            // =========================================================

            var buildingList = document.getElementById('buildingList');
            var searchInput = document.getElementById('searchInput');
            var allBuildings = [];

            // 1. ê±´ë¬¼ ë°ì´í„°ë¥¼ ë°°ì—´ë¡œ ë³€í™˜ ë° ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬
            for (var id in buildings) {
                allBuildings.push({
                    id: id,
                    name: buildings[id].buildingInfo.name,
                    address: buildings[id].buildingInfo.address,
                    image_url: buildings[id].buildingInfo.image_url,
                    center: naver.maps.LatLngBounds.getBoundsFromCoords(buildings[id].polygonCoords).getCenter()
                });
            }

            // ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬
            allBuildings.sort(function(a, b) {
                return a.name.localeCompare(b.name, 'ko-KR');
            });

            // 2. ë¦¬ìŠ¤íŠ¸ ìƒì„±
            function renderBuildingList(list) {
                buildingList.innerHTML = '';
                list.forEach(function(item) {
                    var li = document.createElement('li');
                    li.className = 'building-item';
                    li.id = 'list-item-' + item.id;
                    li.innerHTML = `
                        <img src="${item.image_url}" alt="${item.name}" class="building-list-image">
                        <div class="building-info-text">
                            <span class="building-name">${item.name}</span>
                            <span class="building-address">${item.address}</span>
                        </div>
                    `;

                    // ë¦¬ìŠ¤íŠ¸ í´ë¦­ ì´ë²¤íŠ¸: ê±´ë¬¼ ì¤‘ì‹¬ìœ¼ë¡œ ì§€ë„ ì´ë™ ë° ì‹¤ë‚´ ëª¨ë“œ ì§„ì…
                    li.addEventListener('click', function() {
                        // ì§€ë„ ì¤‘ì‹¬ìœ¼ë¡œ ì´ë™
                        map.panTo(item.center);
                        // ì‹¤ë‚´ ëª¨ë“œ ì§„ì…
                        enterBuildingMode(item.id);
                    });

                    buildingList.appendChild(li);
                });
            }
            
            // ì´ˆê¸° ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
            renderBuildingList(allBuildings);

            // 3. ê²€ìƒ‰ ê¸°ëŠ¥
            searchInput.addEventListener('keyup', function() {
                var query = this.value.toLowerCase();
                var filteredList = allBuildings.filter(function(item) {
                    return item.name.toLowerCase().includes(query) || 
                           item.address.toLowerCase().includes(query);
                });
                renderBuildingList(filteredList);
            });
            
            // 4. ë¦¬ìŠ¤íŠ¸ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function updateBuildingListSelection(selectedId) {
                document.querySelectorAll('#buildingList .building-item').forEach(function(item) {
                    item.classList.remove('selected');
                });
                if (selectedId) {
                    var selectedElement = document.getElementById('list-item-' + selectedId);
                    if (selectedElement) {
                        selectedElement.classList.add('selected');
                        // ìŠ¤í¬ë¡¤ ì´ë™
                        selectedElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }
                }
            }


            // =========================================================
            // ë¬´ì¥ì•  ì‹œì„¤ íŒì—… ê¸°ëŠ¥
            // =========================================================

            var accessBtn = document.getElementById('accessBtn');
            var popup = document.getElementById('accessPopup');
            var popupClose = document.getElementById('popupClose');
            var accessInfoList = document.getElementById('accessInfoList');
            
            // ì´ˆê¸° ë²„íŠ¼ ë¹„í™œì„±í™” (ê±´ë¬¼ ë¯¸ì„ íƒ ìƒíƒœ)
            accessBtn.disabled = true;

            // ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´ íŒì—… ë‚´ìš© ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function updateAccessPopup(building) {
                document.getElementById('popupBuildingName').textContent = building.buildingInfo.name;
                document.getElementById('popupAddress').textContent = building.buildingInfo.address;
                document.getElementById('popupHours').textContent = building.buildingInfo.operating_hours;
                document.getElementById('popupImage').src = building.buildingInfo.image_url;

                accessInfoList.innerHTML = ''; // ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”

                // ì ‘ê·¼ì„± ì •ë³´ ë¦¬ìŠ¤íŠ¸ ìƒì„±
                for (var key in building.accessInfo) {
                    var li = document.createElement('li');
                    li.className = 'access-item';
                    
                    var status = building.accessInfo[key];
                    var statusText = status ? 'O (ìˆìŒ)' : 'X (ì—†ìŒ)';
                    var statusClass = status ? 'status-ok' : 'status-no';

                    li.innerHTML = `
                        <span>${key}:</span>
                        <span class="access-status ${statusClass}">${statusText}</span>
                    `;
                    accessInfoList.appendChild(li);
                }
            }

            // ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            accessBtn.addEventListener('click', function() {
                if (!currentBuildingId) {
                    // coordDisplayëŠ” ì´ë¯¸ ì§€ë„ ìœ„ì— ìˆìœ¼ë¯€ë¡œ, ì§€ë„ ìƒë‹¨ ì¤‘ì•™ì˜ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
                    document.getElementById('coordDisplay').textContent = 'ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´ëŠ” ê±´ë¬¼ì„ í´ë¦­í•˜ì—¬ ì‹¤ë‚´ ëª¨ë“œ ì§„ì… í›„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.';
                    return;
                }

                var isOpen = popup.style.display === 'block';
                
                if (!isOpen) {
                    // í˜„ì¬ ê±´ë¬¼ ì •ë³´ë¡œ íŒì—… ë‚´ìš© ì—…ë°ì´íŠ¸
                    updateAccessPopup(buildings[currentBuildingId]);

                    // íŒì—… í‘œì‹œ (ë²„íŠ¼ ì˜†)
                    popup.style.display = 'block';
                    this.classList.add('active');
                } else {
                    // íŒì—… ë‹«ê¸°
                    popup.style.display = 'none';
                    this.classList.remove('active');
                }
            });
            
            // ë¬´ì¥ì•  ì‹œì„¤ì •ë³´ íŒì—… ë‹«ê¸° ì´ë²¤íŠ¸ (X ë²„íŠ¼ í´ë¦­)
            if (popupClose) {
                popupClose.onclick = function() {
                    popup.style.display = 'none';
                    accessBtn.classList.remove('active');
                };
            }
        };

        // API ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë©”ì‹œì§€
        var script = document.createElement('script');
        script.onerror = function () {
            console.error('ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ ì‹¤íŒ¨! URL ë˜ëŠ” Keyë¥¼ í™•ì¸í•˜ì„¸ìš”.');
        };

        // Naver Map API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ
        window.onload = initMap;
        
    </script>
</body>
</html>

