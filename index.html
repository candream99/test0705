<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë„¤ì´ë²„ ë²¡í„°ë§µ í…ŒìŠ¤íŠ¸ - ë°ìŠ¤í¬íƒ‘ ì „ìš© ë ˆì´ì•„ì›ƒ</title>
    <style>
        /* ------------------------------------------------ */
        /* ê¸°ë³¸ ë ˆì´ì•„ì›ƒ ë° ìŠ¤íƒ€ì¼ */
        /* ------------------------------------------------ */
        body { 
            margin: 0;
            padding: 0; 
            height: 100vh; 
            font-family: 'Malgun Gothic', sans-serif;
            overflow: hidden; 
            display: flex; 
        }

        /* ------------------------------------------------ */
        /* ì¢Œì¸¡ ê²€ìƒ‰ íŒ¨ë„ (1/5) */
        /* ------------------------------------------------ */
        #searchPanel {
            width: 20%; 
            min-width: 250px; 
            height: 100%;
            background: #ffffff;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            padding: 10px;
            box-sizing: border-box;
        }

        /* ------------------------------------------------ */
        /* ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ (íŒ¨ë„ ìƒë‹¨) */
        /* ------------------------------------------------ */
        #searchBox {
            width: 100%;
            height: 48px;
            padding: 0;
            background: #f1f1f1;
            border-radius: 4px;
            box-shadow: none; 
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            position: relative;
        }

        #searchInput {
            flex-grow: 1;
            height: 100%;
            border: none;
            padding: 0 15px;
            font-size: 16px;
            background: transparent;
            outline: none;
        }

        #searchIcon {
            padding: 0 10px;
            font-size: 20px;
            color: #555;
        }

        /* ------------------------------------------------ */
        /* ê±´ë¬¼ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        /* ------------------------------------------------ */
        #buildingList {
            flex-grow: 1;
            overflow-y: auto; 
            padding: 0;
            list-style: none;
            margin: 0;
        }

        .building-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background 0.1s;
        }

        .building-item:hover {
            background: #f9f9f9;
        }

        .building-item.selected {
            background: #e6f7ff;
        }

        .building-list-image {
            width: 50px;
            height: 50px;
            border-radius: 4px;
            object-fit: cover;
            margin-right: 10px;
        }

        .building-info-text {
            display: flex;
            flex-direction: column;
        }

        .building-name {
            font-weight: bold;
            font-size: 15px;
            color: #333;
        }

        .building-address {
            font-size: 12px;
            color: #777;
        }


        /* ------------------------------------------------ */
        /* ìš°ì¸¡ ì§€ë„ ì˜ì—­ (4/5) */
        /* ------------------------------------------------ */
        #map { 
            width: 80%; 
            height: 100%; 
            position: relative;
        }

        /* ------------------------------------------------ */
        /* ì§€ë„ ìœ„ UI ìš”ì†Œ ìœ„ì¹˜ ì¡°ì • */
        /* ------------------------------------------------ */
        
        /* 1. coordDisplay (ì§€ë„ ìƒë‹¨ ì¤‘ì•™) */
        #coordDisplay {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-size: 14px;
            color: #333;
            z-index: 1000; 
            white-space: nowrap;
        }

        /* 2. ì¸µ ë²„íŠ¼ Wrapper (ì§€ë„ ìš°ì¸¡ ìƒë‹¨) */
        #floorBtnWrapper {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 1000;
        }

        .floor-btn {
            width: 40px;
            height: 40px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .floor-btn.active {
            background-color: #4285f4;
            color: white;
            border-color: #4285f4;
        }

        /* 3. ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´ ë²„íŠ¼ (ì§€ë„ ìš°ì¸¡ í•˜ë‹¨) */
        #accessBtn {
            position: absolute;
            right: 20px;
            bottom: 20px;
            width: 48px;
            height: 48px;
            background-color: #ffffff;
            border: none;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            font-size: 24px;
            color: #4285f4;
            z-index: 1000;
        }

        #accessBtn:hover {
            background-color: #f0f0f0;
        }

        #accessBtn.active {
            background-color: #4285f4;
            color: white;
        }

        /* 4. ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´ íŒì—… (ì§€ë„ ìœ„) */
        #accessPopup {
            position: absolute;
            right: 80px; 
            bottom: 20px;
            width: 300px;
            max-height: 400px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            padding: 15px;
        }

        /* íŒì—… ë‚´ë¶€ ìŠ¤íƒ€ì¼ */
        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .popup-header h3 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }

        #popupClose {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #aaa;
        }
        
        #popupImage {
            width: 100%;
            height: auto;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .info-section {
            margin-bottom: 10px;
        }

        .info-section h4 {
            font-size: 14px;
            color: #555;
            margin: 0 0 5px 0;
            border-bottom: 1px dashed #eee;
            padding-bottom: 3px;
        }

        .info-section p {
            font-size: 13px;
            color: #333;
            margin: 0 0 5px 0;
            line-height: 1.4;
        }

        .access-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .access-item {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            padding: 5px 0;
            border-bottom: 1px dotted #f0f0f0;
        }

        .access-status {
            font-weight: bold;
        }

        .status-ok {
            color: #4CAF50;
        }

        .status-no {
            color: #F44336;
        }
    </style>
</head>
<body>
    
    <div id="searchPanel">
        <div id="searchBox">
            <input type="text" id="searchInput" placeholder="ê±´ë¬¼ ì´ë¦„ ê²€ìƒ‰" />
            <div id="searchIcon">ğŸ”</div>
        </div>

        <ul id="buildingList">
            </ul>
    </div>
    
    <div id="map">
        <div id="floorBtnWrapper">
            </div>

        <button id="accessBtn">â„¹</button>

        <div id="accessPopup">
            <div class="popup-header">
                <h3 id="popupBuildingName">ê±´ë¬¼ ì´ë¦„</h3>
                <button id="popupClose">Ã—</button>
            </div>
            <img id="popupImage" src="" alt="ê±´ë¬¼ ì´ë¯¸ì§€" />
            <div class="info-section">
                <h4>ê±´ë¬¼ ì •ë³´</h4>
                <p>ì£¼ì†Œ: <span id="popupAddress"></span></p>
                <p>ìš´ì˜ ì‹œê°„: <span id="popupHours"></span></p>
            </div>
            <div class="info-section">
                <h4>ë¬´ì¥ì•  ì‹œì„¤</h4>
                <ul class="access-list" id="accessInfoList">
                    </ul>
            </div>
        </div>

        <div id="coordDisplay">ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ê±´ë¬¼ ì™¸ê³½ì„ ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.</div>
    </div>


    <script
        type="text/javascript"
        src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=q1d23mmkof**&submodules=panorama"
    ></script>
    <script>
        /**
         * í´ë¼ì´ì–¸íŠ¸ ID: q1d23mmkof
         * API Key ë§¤ê°œë³€ìˆ˜: NCP_KEY_ID (ì‚¬ìš©ì ìš”ì²­ì— ë”°ë¼ ë³€ê²½ë¨)
         */
        var map;
        var currentBuildingId = null;
        var currentPolygon = null;
        var currentOverlay = null;

        // APIê°€ ì •ìƒì ìœ¼ë¡œ ë¡œë“œëœ í›„ ì‹¤í–‰ë  í•¨ìˆ˜
        function initMap() {
            // =========================================================
            // ë¹Œë”©ë³„ ë°ì´í„° ì •ì˜
            // =========================================================
            var ky_default_bounds = new naver.maps.LatLngBounds(
                new naver.maps.LatLng(37.570512, 126.977632),
                new naver.maps.LatLng(37.571415, 126.978244)
            );
            var dt_default_bounds = new naver.maps.LatLngBounds(
                new naver.maps.LatLng(37.570459, 126.978649),
                new naver.maps.LatLng(37.571626, 126.979210)
            );
            var buildings = {
                'ky': { 
                    polygonCoords: [
                        new naver.maps.LatLng(37.571350, 126.977670), new naver.maps.LatLng(37.571360, 126.978059),
                        new naver.maps.LatLng(37.571275, 126.978063), new naver.maps.LatLng(37.571275, 126.978173),
                        new naver.maps.LatLng(37.570870, 126.978184), new naver.maps.LatLng(37.570872, 126.978082),
                        new naver.maps.LatLng(37.570543, 126.978094), new naver.maps.LatLng(37.570539, 126.977702),
                    ],
                    floors: ['b1', '1f', '2f'],
                    images: {
                        'b1': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/kb_b111.png', '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky11.png', 
                        '2f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/ky_1.jpg',
                    },
                    floorBounds: { 
                        'b1': new naver.maps.LatLngBounds(new naver.maps.LatLng(37.571590, 126.978531), new naver.maps.LatLng(37.570465, 126.977552)),
                        '1f': ky_default_bounds, '2f': ky_default_bounds,
                    },
                    currentFloor: '1f', polygon: null,
                    accessInfo: {
                        'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ': true, 'ì¥ì• ì¸ í™”ì¥ì‹¤': true, 'ì§•ì• ì¸ ì£¼ì°¨ì¥': true, 'ì—˜ë¦¬ë² ì´í„°': true, 'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨': false 
                    },
                    buildingInfo: {
                        name: 'êµë³´ë¹Œë”©', image_url: 'https://raw.githubusercontent.com/candream99/disabledmap/main/kb/kyobo_gwanghwamun.jpg', 
                        address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ìƒˆë¬¸ì•ˆë¡œ 45', operating_hours: '09:00 - 18:00 (ì›”ìš”ì¼ íœ´ë¬´)'
                    }
                },
                'dt': { 
                    polygonCoords: [
                        new naver.maps.LatLng(37.571470, 126.978762), new naver.maps.LatLng(37.571476, 126.979161),
                        new naver.maps.LatLng(37.570627, 126.979181), new naver.maps.LatLng(37.570557, 126.979117),
                        new naver.maps.LatLng(37.570553, 126.978777),
                    ],
                    floors: ['b4', '1f'], 
                    images: {
                        'b4': 'https://raw.githubusercontent.com/candream99/disabledmap/main/dt/dt_b4.png', '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/dt/dt1.png',
                    },
                    floorBounds: { 
                        'b4': dt_default_bounds, '1f': dt_default_bounds,
                    },
                    currentFloor: '1f', polygon: null,
                    accessInfo: {
                        'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ': false, 'ì¥ì• ì¸ í™”ì¥ì‹¤': true, 'ì¥ì• ì¸ ì£¼ì°¨ì¥': false, 'ì—˜ë¦¬ë² ì´í„°': true, 'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨': true 
                    },
                    buildingInfo: {
                        name: 'ê´‘í™”ë¬¸ Díƒ€ì›Œ', image_url: 'https://raw.githubusercontent.com/candream99/disabledmap/main/dt/d_tower.jpg', 
                        address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ì†¡ì›”ê¸¸ 2', operating_hours: '10:00 - 19:00 (ë§¤ì¼ ìš´ì˜)'
                    }
                },
                't8': { 
                    polygonCoords: [
                        new naver.maps.LatLng(37.570859, 126.980318), new naver.maps.LatLng(37.570854, 126.980784),
                        new naver.maps.LatLng(37.570515, 126.980785), new naver.maps.LatLng(37.570514, 126.980841),
                        new naver.maps.LatLng(37.570417, 126.980840), new naver.maps.LatLng(37.570418, 126.980288),
                        new naver.maps.LatLng(37.570518, 126.980287), new naver.maps.LatLng(37.570518, 126.980315),
                    ],
                    floors: ['b2', 'b1', '1f'],
                    images: {
                        'b2': 'https://raw.githubusercontent.com/candream99/disabledmap/main/T8/T8_b2.png', 'b1': 'https://raw.githubusercontent.com/candream99/disabledmap/main/T8/T8_b1.png',
                        '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/T8/T8_1.png',
                    },
                    floorBounds: { 
                        'b2': new naver.maps.LatLngBounds(new naver.maps.LatLng(37.570405, 126.980209), new naver.maps.LatLng(37.570902, 126.981077)),
                        'b1': new naver.maps.LatLngBounds(new naver.maps.LatLng(37.570405, 126.980209), new naver.maps.LatLng(37.570902, 126.981077)),
                        '1f': new naver.maps.LatLngBounds(new naver.maps.LatLng(37.570405, 126.980209), new naver.maps.LatLng(37.570902, 126.981077)),
                    },
                    currentFloor: '1f', polygon: null,
                    accessInfo: {
                        'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ': true, 'ì¥ì• ì¸ í™”ì¥ì‹¤': false, 'ì¥ì• ì¸ ì£¼ì°¨ì¥': true, 'ì—˜ë¦¬ë² ì´í„°': true, 'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨': false 
                    },
                    buildingInfo: {
                        name: 'íƒ€ì›Œ8', image_url: 'https://raw.githubusercontent.com/candream99/disabledmap/main/T8/t88.jpg', 
                        address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ì²­ì§„ë™ 167 (ì„ì˜)', operating_hours: '08:00 - 22:00 (ì£¼ë§ í¬í•¨)'
                    }
                },
                'officia': { 
                    polygonCoords: [
                        new naver.maps.LatLng(37.569884, 126.974610), new naver.maps.LatLng(37.569882, 126.975265),
                        new naver.maps.LatLng(37.569580, 126.975261), new naver.maps.LatLng(37.569581, 126.974603),
                    ],
                    floors: ['b2', 'b1', '1f'], 
                    images: {
                        'b2': 'https://raw.githubusercontent.com/candream99/disabledmap/main/officia/officia_b1.png', 'b1': 'https://raw.githubusercontent.com/candream99/disabledmap/main/officia/officia_b1.png',
                        '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/officia/officia_1f.png',
                    },
                    floorBounds: { 
                        'b2': new naver.maps.LatLngBounds(new naver.maps.LatLng(37.569519, 126.974473), new naver.maps.LatLng(37.569976, 126.975331)),
                        'b1': new naver.maps.LatLngBounds(new naver.maps.LatLng(37.569519, 126.974473), new naver.maps.LatLng(37.569976, 126.975331)),
                        '1f': new naver.maps.LatLngBounds(new naver.maps.LatLng(37.569519, 126.974473), new naver.maps.LatLng(37.569976, 126.975331)),
                    },
                    currentFloor: '1f', polygon: null,
                    accessInfo: {
                        'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ': true, 'ì¥ì• ì¸ í™”ì¥ì‹¤': true, 'ì¥ì• ì¸ ì£¼ì°¨ì¥': true, 'ì—˜ë¦¬ë² ì´í„°': true, 'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨': false 
                    },
                    buildingInfo: { 
                        name: 'ê´‘í™”ë¬¸ ì˜¤í”¼ì‹œì•„', image_url: 'https://raw.githubusercontent.com/candream99/disabledmap/main/officia/officia_.jpg', 
                        address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ìƒˆë¬¸ì•ˆë¡œ5ê¸¸ 37 (ì„ì˜ ì£¼ì†Œ)', operating_hours: '10:00 - 20:00 (ì£¼ë§ íœ´ë¬´, ì„ì˜)'
                    }
                },
                'st': { 
                    polygonCoords: [
                        new naver.maps.LatLng(37.569910, 126.973684), new naver.maps.LatLng(37.569904, 126.974217),
                        new naver.maps.LatLng(37.569688, 126.974214), new naver.maps.LatLng(37.569688, 126.973680),
                    ],
                    floors: ['b2', 'b1', '1f'], 
                    images: {
                        'b2': 'https://raw.githubusercontent.com/candream99/disabledmap/main/st/st_b1.png', 'b1': 'https://raw.githubusercontent.com/candream99/disabledmap/main/st/st_b1.png',
                        '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/st/st_1.png',
                    },
                    floorBounds: { 
                        'b2': new naver.maps.LatLngBounds(new naver.maps.LatLng(37.569473, 126.973510), new naver.maps.LatLng(37.570081, 126.974351)),
                        'b1': new naver.maps.LatLngBounds(new naver.maps.LatLng(37.569473, 126.973510), new naver.maps.LatLng(37.570081, 126.974351)),
                        '1f': new naver.maps.LatLngBounds(new naver.maps.LatLng(37.569473, 126.973510), new naver.maps.LatLng(37.570081, 126.974351)),
                    },
                    currentFloor: '1f', polygon: null,
                    accessInfo: {
                        'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ': false, 'ì¥ì• ì¸ í™”ì¥ì‹¤': true, 'ì¥ì• ì¸ ì£¼ì°¨ì¥': true, 'ì—˜ë¦¬ë² ì´í„°': true, 'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨': true 
                    },
                    buildingInfo: { 
                        name: 'Síƒ€ì›Œ', image_url: 'https://raw.githubusercontent.com/candream99/disabledmap/main/st/s_tower.jpg', 
                        address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ì„¸ì¢…ëŒ€ë¡œ 172 (ì„ì˜ ì£¼ì†Œ)', operating_hours: '11:00 - 20:00 (ì£¼ë§ í¬í•¨, ì„ì˜)'
                    }
                },
                'yp': { 
                    polygonCoords: [
                        new naver.maps.LatLng(37.569881, 126.981938), new naver.maps.LatLng(37.569879, 126.982329),
                        new naver.maps.LatLng(37.569829, 126.982332), new naver.maps.LatLng(37.569828, 126.982395),
                        new naver.maps.LatLng(37.569780, 126.982395), new naver.maps.LatLng(37.569777, 126.982463),
                        new naver.maps.LatLng(37.569463, 126.982461), new naver.maps.LatLng(37.569462, 126.982068),
                        new naver.maps.LatLng(37.569565, 126.981938),
                    ],
                    floors: ['b1', '1f'], 
                    images: {
                        'b1': 'https://raw.githubusercontent.com/candream99/disabledmap/main/yp/yp1.png', '1f': 'https://raw.githubusercontent.com/candream99/disabledmap/main/yp/yp1.png',
                    },
                    floorBounds: { 
                        'b1': new naver.maps.LatLngBounds(new naver.maps.LatLng(37.569438, 126.981870), new naver.maps.LatLng(37.569943, 126.982556)),
                        '1f': new naver.maps.LatLngBounds(new naver.maps.LatLng(37.569438, 126.981870), new naver.maps.LatLng(37.569943, 126.982556)),
                    },
                    currentFloor: '1f', polygon: null,
                    accessInfo: {
                        'ì£¼ì¶œì…êµ¬ ê²½ì‚¬ë¡œ': true, 'ì¥ì• ì¸ í™”ì¥ì‹¤': true, 'ì¥ì• ì¸ ì£¼ì°¨ì¥': false, 'ì—˜ë¦¬ë² ì´í„°': true, 'ì£¼ì¶œì…êµ¬ ë‹¨ì°¨': false 
                    },
                    buildingInfo: { 
                        name: 'ì˜í’ë¹Œë”©', image_url: 'https://raw.githubusercontent.com/candream99/disabledmap/main/yp/yp_i.jpg', 
                        address: 'ì„œìš¸ ì¢…ë¡œêµ¬ ì²­ê³„ì²œë¡œ 41 (ì„ì˜ ì£¼ì†Œ)', operating_hours: '09:00 - 21:00 (ì„ì˜)'
                    }
                }
            };

            // ì´ˆê¸° ì§€ë„ ì„¤ì •
            var mapOptions = {
                center: new naver.maps.LatLng(37.56701, 126.97722), zoom: 18, 
                mapTypeId: naver.maps.MapTypeId.NORMAL,
                mapTypes: new naver.maps.MapTypeRegistry({
                    'indoor': {
                        minZoom: 18, maxZoom: 20, name: 'ì‹¤ë‚´ì§€ë„',
                        getTileUrl: function(x, y, z) {
                            return 'https://map.naver.com/indoor/tiles/indoor_v1/indoor_v1/' + z + '/' + x + '/' + y + '.png';
                        }
                    }
                }),
                tileSet: 'indoor',
                vector: true,
            };

            map = new naver.maps.Map('map', mapOptions);

            // =========================================================
            // í•¨ìˆ˜: í´ë¦¬ê³¤ ê·¸ë¦¬ê¸° ë° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            // =========================================================
            function drawBuildingPolygon(id, building) {
                var polygon = new naver.maps.Polygon({
                    paths: building.polygonCoords,
                    fillColor: '#FF0000', fillOpacity: 0.2, strokeColor: '#FF0000',
                    strokeOpacity: 0.8, strokeWeight: 2, map: map
                });
                building.polygon = polygon;
                naver.maps.Event.addListener(polygon, 'click', function(e) {
                    enterBuildingMode(id);
                });
            }

            // =========================================================
            // í•¨ìˆ˜: ì‹¤ë‚´ ëª¨ë“œ ì§„ì… ë° ì˜¤ë²„ë ˆì´ í‘œì‹œ
            // =========================================================
            function enterBuildingMode(id) {
                if (currentBuildingId === id) return;
                
                if (currentBuildingId && buildings[currentBuildingId].polygon) {
                    buildings[currentBuildingId].polygon.setOptions({
                        fillColor: '#FF0000', fillOpacity: 0.2
                    });
                }
                
                updateBuildingListSelection(id);
                currentBuildingId = id;
                var building = buildings[id];

                if (building.polygon) {
                    building.polygon.setOptions({
                        fillColor: '#007AFF', fillOpacity: 0.4
                    });
                }
                
                var bounds = naver.maps.LatLngBounds.getBoundsFromCoords(building.polygonCoords);
                map.panTo(bounds.getCenter());

                createFloorButtons(id);
                updateFloorOverlay(id, building.currentFloor);

                var coordDisplay = document.getElementById('coordDisplay');
                coordDisplay.textContent = building.buildingInfo.name + ' ì‹¤ë‚´ ëª¨ë“œ ì§„ì…. ì¸µì„ ì„ íƒí•˜ê±°ë‚˜ ì§€ë„ë¥¼ ì´ë™í•˜ì„¸ìš”.';
                
                document.getElementById('accessBtn').disabled = false;
            }

            // =========================================================
            // í•¨ìˆ˜: ì¸µ ë²„íŠ¼ ìƒì„± ë° ì´ë²¤íŠ¸ ì—°ê²°
            // =========================================================
            function createFloorButtons(id) {
                var wrapper = document.getElementById('floorBtnWrapper');
                wrapper.innerHTML = ''; 
                var building = buildings[id];

                building.floors.slice().reverse().forEach(function(floor) {
                    var btn = document.createElement('button');
                    btn.className = 'floor-btn';
                    btn.textContent = floor.toUpperCase();
                    btn.id = 'btn-' + floor;
                    
                    if (floor === building.currentFloor) {
                        btn.classList.add('active');
                    }

                    btn.onclick = function() {
                        updateFloorOverlay(id, floor);
                        document.querySelectorAll('#floorBtnWrapper .floor-btn').forEach(function(b) {
                            b.classList.remove('active');
                        });
                        this.classList.add('active');
                    };

                    wrapper.appendChild(btn);
                });
            }

            // =========================================================
            // í•¨ìˆ˜: ì˜¤ë²„ë ˆì´ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
            // =========================================================
            function updateFloorOverlay(id, floor) {
                var building = buildings[id];

                if (currentOverlay) {
                    currentOverlay.setMap(null);
                }

                building.currentFloor = floor;
                
                var imageUrl = building.images[floor];
                var bounds = building.floorBounds[floor];

                currentOverlay = new naver.maps.GroundOverlay(
                    imageUrl, bounds, { map: map, opacity: 0.8 }
                );
                
                var coordDisplay = document.getElementById('coordDisplay');
                coordDisplay.textContent = building.buildingInfo.name + ' - ' + floor.toUpperCase() + ' ì¸µì„ ë³´ê³  ìˆìŠµë‹ˆë‹¤.';
            }

            // =========================================================
            // ì§€ë„ ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ì—°ê²°
            // =========================================================

            for (var id in buildings) {
                drawBuildingPolygon(id, buildings[id]);
            }
            
            naver.maps.Event.addListener(map, 'click', function(e) {
                if (e.originalEvent.target.tagName === 'BUTTON' || e.originalEvent.target.tagName === 'path') {
                    return; 
                }

                if (currentBuildingId) {
                    if (buildings[currentBuildingId].polygon) {
                        buildings[currentBuildingId].polygon.setOptions({
                            fillColor: '#FF0000', fillOpacity: 0.2
                        });
                    }
                    
                    if (currentOverlay) {
                        currentOverlay.setMap(null);
                        currentOverlay = null;
                    }
                    
                    document.getElementById('floorBtnWrapper').innerHTML = '';
                    
                    document.getElementById('accessBtn').disabled = true;
                    document.getElementById('accessPopup').style.display = 'none';
                    document.getElementById('accessBtn').classList.remove('active');

                    currentBuildingId = null;
                    
                    updateBuildingListSelection(null);

                    var coordDisplay = document.getElementById('coordDisplay');
                    coordDisplay.textContent = 'ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ê±´ë¬¼ ì™¸ê³½ì„ ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.';
                }
            });

            // =========================================================
            // ê²€ìƒ‰ íŒ¨ë„ ë° ë¦¬ìŠ¤íŠ¸ ê¸°ëŠ¥ (ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬ í¬í•¨)
            // =========================================================

            var buildingList = document.getElementById('buildingList');
            var searchInput = document.getElementById('searchInput');
            var allBuildings = [];

            for (var id in buildings) {
                allBuildings.push({
                    id: id,
                    name: buildings[id].buildingInfo.name,
                    address: buildings[id].buildingInfo.address,
                    image_url: buildings[id].buildingInfo.image_url,
                    center: naver.maps.LatLngBounds.getBoundsFromCoords(buildings[id].polygonCoords).getCenter()
                });
            }

            // ê°€ë‚˜ë‹¤ìˆœ ì •ë ¬
            allBuildings.sort(function(a, b) {
                return a.name.localeCompare(b.name, 'ko-KR');
            });

            function renderBuildingList(list) {
                buildingList.innerHTML = '';
                list.forEach(function(item) {
                    var li = document.createElement('li');
                    li.className = 'building-item';
                    li.id = 'list-item-' + item.id;
                    li.innerHTML = `
                        <img src="${item.image_url}" alt="${item.name}" class="building-list-image">
                        <div class="building-info-text">
                            <span class="building-name">${item.name}</span>
                            <span class="building-address">${item.address}</span>
                        </div>
                    `;

                    li.addEventListener('click', function() {
                        map.panTo(item.center);
                        enterBuildingMode(item.id);
                    });

                    buildingList.appendChild(li);
                });
            }
            
            renderBuildingList(allBuildings);

            searchInput.addEventListener('keyup', function() {
                var query = this.value.toLowerCase();
                var filteredList = allBuildings.filter(function(item) {
                    return item.name.toLowerCase().includes(query) || 
                           item.address.toLowerCase().includes(query);
                });
                renderBuildingList(filteredList);
            });
            
            function updateBuildingListSelection(selectedId) {
                document.querySelectorAll('#buildingList .building-item').forEach(function(item) {
                    item.classList.remove('selected');
                });
                if (selectedId) {
                    var selectedElement = document.getElementById('list-item-' + selectedId);
                    if (selectedElement) {
                        selectedElement.classList.add('selected');
                        selectedElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }
                }
            }


            // =========================================================
            // ë¬´ì¥ì•  ì‹œì„¤ íŒì—… ê¸°ëŠ¥
            // =========================================================

            var accessBtn = document.getElementById('accessBtn');
            var popup = document.getElementById('accessPopup');
            var popupClose = document.getElementById('popupClose');
            var accessInfoList = document.getElementById('accessInfoList');
            var coordDisplay = document.getElementById('coordDisplay');
            
            accessBtn.disabled = true;

            function updateAccessPopup(building) {
                document.getElementById('popupBuildingName').textContent = building.buildingInfo.name;
                document.getElementById('popupAddress').textContent = building.buildingInfo.address;
                document.getElementById('popupHours').textContent = building.buildingInfo.operating_hours;
                document.getElementById('popupImage').src = building.buildingInfo.image_url;

                accessInfoList.innerHTML = '';

                for (var key in building.accessInfo) {
                    var li = document.createElement('li');
                    li.className = 'access-item';
                    
                    var status = building.accessInfo[key];
                    var statusText = status ? 'O (ìˆìŒ)' : 'X (ì—†ìŒ)';
                    var statusClass = status ? 'status-ok' : 'status-no';

                    li.innerHTML = `
                        <span>${key}:</span>
                        <span class="access-status ${statusClass}">${statusText}</span>
                    `;
                    accessInfoList.appendChild(li);
                }
            }

            accessBtn.addEventListener('click', function() {
                if (!currentBuildingId) {
                    coordDisplay.textContent = 'ë¬´ì¥ì•  ì‹œì„¤ ì •ë³´ëŠ” ê±´ë¬¼ì„ í´ë¦­í•˜ì—¬ ì‹¤ë‚´ ëª¨ë“œ ì§„ì… í›„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.';
                    return;
                }

                var isOpen = popup.style.display === 'block';
                
                if (!isOpen) {
                    updateAccessPopup(buildings[currentBuildingId]);
                    popup.style.display = 'block';
                    this.classList.add('active');
                } else {
                    popup.style.display = 'none';
                    this.classList.remove('active');
                }
            });
            
            if (popupClose) {
                popupClose.onclick = function() {
                    popup.style.display = 'none';
                    accessBtn.classList.remove('active');
                };
            }
        };

        window.onload = initMap;
    </script>
</body>
</html>


